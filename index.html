<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <script>

        function TimeAdder(t1, t2) {
            t1 = t1.split(":");
            t2 = t2.split(":");
            let sec = parseInt(t1[2]) + parseInt(t2[2]);
            let mint = parseInt(t1[1]) + parseInt(t2[1]);
            let hrs = parseInt(t1[0]) + parseInt(t2[0]);
            if (sec >= 60) {
                sec -= 60;
                mint += 1;
            }
            if (mint >= 60) {
                mint -= 60;
                hrs += 1;
            }
            return hrs.toString() + ':' + mint.toString() + ':' + sec.toString();
        }


        function getDate() {
            const now = new Date();
            const options = {
                hour: 'numeric',
                minute: 'numeric',
                second: 'numeric',
                hour12: false,
                timeZone: 'Asia/Kolkata'
            };
            const time24hrs = now.toLocaleTimeString('en-IN', options);
            return (time24hrs);
        }


        function TimeDiff(t1, t2,flag=0) {
            if (t2 == "MISSING") {
                t2 = getDate();
            }
            t1 = t1.split(":");
            t2 = t2.split(":");
            for (let i = 0; i < 3; i++) {
                if (i == 0) {
                    if (parseInt(t1[i]) > 23 || parseInt(t2[i]) > 23 ) {

                        return 404;
                    }
                }
                if (isNaN(t1[i]) == true || isNaN(t2[i]) == true || parseInt(t1[i]) > 59 || parseInt(t2[i]) > 59 || parseInt(t1[i]) < 0 || parseInt(t2[i]) < 0) {
                    return 404;
                }
            }
            let sec = 60 - parseInt(t1[2]);
            let mint = 0;
            if (sec != 60) {
                mint += 1;
            }
            mint = 60 - (parseInt(t1[1]) + mint);
            let hrs = parseInt(t1[0]);
            if (mint != 60) {
                hrs += 1;
            }
            if (sec == 60) {
                sec = 0;
            }
            if (mint == 60) {
                mint = 0;
            }
            sec += parseInt(t2[2]);
            if (sec >= 60) {
                sec -= 60;
                mint += 1;
            }
            mint += parseInt(t2[1]);
            if (parseInt(t1[0]) > parseInt(t2[0]) && flag == 0) {
                hrs = 24 - hrs;
                hrs += parseInt(t2[0]);
            }
            else {
                hrs = parseInt(t2[0]) - hrs;
            }
            if (mint >= 60) {
                mint -= 60;
                hrs += 1;
            }
            return hrs.toString() + ':' + mint.toString() + ':' + sec.toString();
        }


        function Error(output1, time1, displayEffectiveHours1) {
            displayEffectiveHours1.innerHTML = " "
            output1.innerHTML = " ";
            time1.innerHTML = "";
            output1.className = 'fadeOut ';
            output1.focus();
            output1.className = 'fadeIn output';
            time1.className = 'fadeOut ';
            time1.focus();
            time1.className = 'fadeIn output';
            output1.innerHTML = "Please Enter Logs in <br> Correct Format ";
            time1.innerHTML = "";
            return;
        }

        function evaluator() {
            var output1 = document.getElementById('output');
            var time1 = document.getElementById('time');
            var displayEffectiveHours1 = document.getElementById('displayEffectiveHours');
            var requiredEffectiveHours = document.getElementById('effectiveTime').value;
            requiredEffectiveHours = requiredEffectiveHours.trim();
            var effectiveHours = "00:00:00";
            var flag = 0;
            var endTime = "";
            var a = document.getElementById('logs').value;
            a = a.trim();
            let b = a.split(/(\s)/).filter((x) => x.trim().length > 0);
            if (b.length % 2 != 0 || a.length == 0 || !b || !a || !requiredEffectiveHours) {
                Error(output1, time1, displayEffectiveHours1);
                return;
            }
            for (let i = 0; i < b.length; i += 2) {
                let diff = TimeDiff(b[i], b[i + 1]);
                if (diff == 404) {
                    Error(output1, time1, displayEffectiveHours1);
                    return;
                }
                effectiveHours = TimeAdder(effectiveHours, diff);
            }
            let balancedEffectiveHours = TimeDiff(effectiveHours, requiredEffectiveHours,1);
            if (balancedEffectiveHours[0] == '-') {
                flag = 1;
            }
            else {
                endTime = TimeAdder(balancedEffectiveHours, getDate());
            }
            if (flag == 1) {
                output1.innerHTML = " ";
                time1.innerHTML = "";
                output1.className = 'fadeOut ';
                output1.focus();
                output1.className = 'fadeIn output';
                time1.className = 'fadeOut ';
                time1.focus();
                time1.className = 'fadeIn output';
                output1.innerHTML = "You can Leave Thank You";
                time1.innerHTML = "";
            }
            else {
                if (endTime.includes('NaN')) {
                    Error(output1, time1, displayEffectiveHours1);
                    return;
                }
                output1.innerHTML = " ";
                time1.innerHTML = "";
                output1.className = 'fadeOut ';
                output1.focus();
                output1.className = 'fadeIn output';
                time1.className = 'fadeOut ';
                time1.focus();
                time1.className = 'fadeIn time';
                output1.innerHTML = "You can Leave at";
                time1.innerHTML = endTime;
            }
            displayEffectiveHours1.innerHTML = "EffectiveHours:" + effectiveHours;
        }

    </script>


    <div class="main">
    </div>

    <div class="information">
        <div class="logsText">Please Enter Required <span class="d">Effective Hours <br> (Example : 08:30:00)</span>
        </div>
        <input type="text" id="effectiveTime" value="08:00:00" />
        <div class="logsText">Copy Logs from Keka <span class="d">in 24Hrs Format<br> (HH:MM:SS) and enter below</span>
        </div>
        <input type="text" id="logs" />
        <button class="logButton" id="logButton" onclick="evaluator()">SUBMIT</button>
        <script>
            var input = document.getElementById("logs");
            input.addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    document.getElementById("logButton").click();
                }
            });
        </script>
        <div>
            <div class="output" id="output"> </div>
            <div class="time" id="time" style="margin-top: -5px;"></div>
            <div class="displayEffectiveHours" id="displayEffectiveHours"></div>
        </div>
    </div>

</html>